<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°”è±¡å®éªŒå®¤ 6.0 - æ²‰æµ¸ç‰ˆ</title>
    <style>
        :root { --glass: rgba(0, 0, 0, 0.3); --text: #ffffff; }
        
        /* åŸºç¡€æ ·å¼ */
        body { 
            margin: 0; min-height: 100vh; color: var(--text);
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            display: flex; justify-content: center; align-items: center;
            overflow-x: hidden; background: #2c3e50; /* é»˜è®¤åº•è‰² */
        }

        /* --- å¤©æ°”åŠ¨ç”»èƒŒæ™¯å®¹å™¨ --- */
        #weather-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; transition: background 2s ease;
        }

        /* é›¨ç‚¹åŠ¨ç”» */
        .rain-drop {
            position: absolute; background: rgba(255,255,255,0.4);
            width: 2px; height: 15px; top: -20px;
            animation: fall linear infinite;
        }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* å®¹å™¨ */
        .container {
            background: var(--glass); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 28px;
            padding: 30px; width: 95%; max-width: 800px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        h1 { text-align: center; font-weight: 300; margin: 0 0 25px 0; }

        /* --- 3:1:2 å¸ƒå±€ --- */
        .temp-section { display: flex; gap: 15px; margin-bottom: 20px; }
        .temp-col-left { flex: 3; }   /* æ—©ä¸­æ™š */
        .temp-col-mid { flex: 1; text-align: center; } /* å…¨å¤©å¹³å‡ */
        .temp-col-right { flex: 2; }  /* ç™½å¤©å¤œé—´ */

        .card-inner { 
            background: rgba(255,255,255,0.1); padding: 12px; 
            border-radius: 15px; height: 100%; display: flex; flex-direction: column; justify-content: space-around;
        }

        .label { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
        .val { font-size: 1.1rem; font-weight: bold; }

        /* é€šç”¨ç½‘æ ¼ */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .sub-card { background: rgba(255,255,255,0.08); padding: 15px; border-radius: 15px; }

        /* --- è¯¦ç»†ç©¿æ­å»ºè®® --- */
        .advice-box { 
            background: rgba(255,255,255,0.15); border-left: 4px solid #00d2ff;
            padding: 20px; border-radius: 15px; line-height: 1.8;
        }
        .advice-tag { color: #00d2ff; font-weight: bold; margin-right: 8px; }

        button {
            width: 100%; padding: 15px; border-radius: 15px; border: none;
            background: #fff; color: #333; font-weight: bold; cursor: pointer;
            transition: 0.3s; margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="weather-bg"></div>

<div class="container">
    <h1 id="cityName">æ°”è±¡å®éªŒå®¤ 6.0</h1>

    <div class="temp-section">
        <div class="temp-col-left">
            <div class="card-inner">
                <div class="label">æ—©ä¸­æ™šä½“æ„Ÿ</div>
                <div class="val">ğŸŒ… <span id="t-morn">--</span></div>
                <div class="val">â˜€ï¸ <span id="t-noon">--</span></div>
                <div class="val">ğŸŒ™ <span id="t-eve">--</span></div>
            </div>
        </div>
        <div class="temp-col-mid">
            <div class="card-inner">
                <div class="label">å…¨å¤©å¹³å‡</div>
                <div id="t-all-avg" style="font-size: 1.5rem; color: #f1c40f;">--</div>
            </div>
        </div>
        <div class="temp-col-right">
            <div class="card-inner">
                <div class="label">ç™½/å¤œå¹³å‡</div>
                <div><span class="label">æ˜¼:</span> <span id="t-day-avg" class="val">--</span></div>
                <div><span class="label">å¤œ:</span> <span id="t-night-avg" class="val">--</span></div>
            </div>
        </div>
    </div>

    <div class="data-grid">
        <div class="sub-card">
            <span class="label">ç©ºæ°”æ¹¿åº¦ (æœ€ä½³ 45-65%)</span>
            <span id="hum-val" class="val">--</span>
        </div>
        <div class="sub-card">
            <span class="label">æ—¥ç…§å¼ºåº¦ (0-11+)</span>
            <span id="uv-val" class="val">--</span>
        </div>
    </div>

    <div class="data-grid">
        <div class="sub-card">
            <span class="label">å®æ—¶é£é€Ÿ/é£å‘ (m/s)</span>
            <span id="wind-now" class="val">--</span>
        </div>
        <div class="sub-card">
            <span class="label">æ—¥ç…§ (å‡º/è½)</span>
            <span id="sun-time" class="val">--</span>
        </div>
    </div>

    <div class="advice-box" id="advice-content">ç‚¹å‡»åŒæ­¥æ•°æ®åç”Ÿæˆå»ºè®®...</div>

    <button id="syncBtn">åŒæ­¥å®æ—¶æ°”è±¡ä¸åŠ¨ç”»</button>
</div>

<script>
    const $ = (id) => document.getElementById(id);

    const cityMap = { "Wuxi": "æ— é”¡", "Shanghai": "ä¸Šæµ·", "Beijing": "åŒ—äº¬", "Suzhou": "è‹å·", "Nanjing": "å—äº¬", "Hangzhou": "æ­å·" };
    const windMap = { "N": "åŒ—é£", "S": "å—é£", "E": "ä¸œé£", "W": "è¥¿é£", "NE": "ä¸œåŒ—é£", "NW": "è¥¿åŒ—é£", "SE": "ä¸œå—é£", "SW": "è¥¿å—é£" };

    // --- èƒŒæ™¯åŠ¨ç”»æ§åˆ¶ ---
    function setWeatherEffect(desc, windSpeed, rain) {
        const bg = $('weather-bg');
        bg.innerHTML = ''; // æ¸…ç©ºæ—§åŠ¨ç”»
        
        if (desc.includes("é›¨")) {
            bg.style.background = "#1a1a2e";
            const density = rain > 5 ? 150 : 60; // æ ¹æ®é›¨é‡å†³å®šé›¨æ»´æ•°
            for(let i=0; i<density; i++) {
                let drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = Math.random() * 100 + 'vw';
                drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                bg.appendChild(drop);
            }
        } else if (desc.includes("æ™´")) {
            bg.style.background = "linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%)";
        } else {
            bg.style.background = "#4a69bd"; // é˜´å¤©/å¤šäº‘
        }
    }

    $('syncBtn').onclick = () => {
        fetch('https://wttr.in/?format=j1')
            .then(res => res.json())
            .then(data => {
                const cur = data.current_condition[0];
                const weather = data.weather[0];
                const hourly = weather.hourly;
                const area = data.nearest_area[0].areaName[0].value;

                // åŸå¸‚åæ±‰åŒ–
                $('cityName').innerText = (cityMap[area] || area) + " æ°”è±¡ç«™";

                // æ¸©åº¦å¡«å……
                $('t-morn').innerText = hourly[3].FeelsLikeC + "Â°C";
                $('t-noon').innerText = hourly[4].FeelsLikeC + "Â°C";
                $('t-eve').innerText = hourly[7].FeelsLikeC + "Â°C";
                
                const allAvg = (hourly.reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 8).toFixed(1);
                $('t-all-avg').innerText = allAvg + "Â°C";
                
                const dAvg = (hourly.slice(3, 7).reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 4).toFixed(1);
                const nAvg = (hourly.slice(0, 3).concat(hourly[7]).reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 4).toFixed(1);
                $('t-day-avg').innerText = dAvg + "Â°C";
                $('t-night-avg').innerText = nAvg + "Â°C";

                // æ¹¿åº¦/UV/é£é€Ÿ
                $('hum-val').innerText = `${cur.humidity}%`;
                $('uv-val').innerText = `${cur.uvIndex} (å»ºè®®${cur.uvIndex > 3 ? 'æ¶‚æŠ¹é˜²æ™’' : 'è‡ªç„¶å‡ºè¡Œ'})`;
                $('wind-now').innerText = `${(cur.windspeedKmph * 0.278).toFixed(1)} m/s (${windMap[cur.winddir16Point] || cur.winddir16Point})`;
                $('sun-time').innerText = `${weather.astronomy[0].sunrise} / ${weather.astronomy[0].sunset}`;

                // --- ä¸‰å±‚ç©¿è¡£å»ºè®® ---
                const feels = parseInt(cur.FeelsLikeC);
                let colorAdvice = feels > 20 ? "æµ…è‰²ç³»ï¼ˆç™½ã€ç±³ã€æµ…è“ï¼‰æ›´æ¸…çˆ½" : "æ·±è‰²ç³»ï¼ˆç„¦ç³–ã€æ·±ç°ã€è—è“ï¼‰æ›´å¸çƒ­ä¿æš–";
                let layers = "";

                if(feels >= 25) {
                    layers = `
                        <div><span class="advice-tag">æ’æ±—å±‚:</span> çº¯æ£‰æˆ–é€Ÿå¹²çŸ­è¢–ï¼Œä¿æŒå¹²çˆ½</div>
                        <div><span class="advice-tag">ä¸‹è£…:</span> äºšéº»å‡‰çˆ½é•¿è£¤æˆ–è¿åŠ¨çŸ­è£¤</div>
                        <div><span class="advice-tag">é‹å±¥:</span> é€æ°”ç½‘é¢è¿åŠ¨é‹</div>
                    `;
                } else if(feels >= 15) {
                    layers = `
                        <div><span class="advice-tag">å†…å±‚:</span> é•¿è¢–æ£‰è´¨Tæ¤</div>
                        <div><span class="advice-tag">ä¿æš–å±‚:</span> è–„é’ˆç»‡è¡«æˆ–è¡¬è¡«</div>
                        <div><span class="advice-tag">å¤–å±‚:</span> é˜²é£å¤¹å…‹æˆ–ç‰›ä»”å¤–å¥—</div>
                    `;
                } else {
                    layers = `
                        <div><span class="advice-tag">å†…å±‚:</span> å¾·ç»’æˆ–çœŸä¸ä¿æš–å†…è¡£</div>
                        <div><span class="advice-tag">ä¿æš–å±‚:</span> ç¾Šç»’è¡«æˆ–åŠ ç»’å«è¡£</div>
                        <div><span class="advice-tag">é˜²é£å±‚:</span> å……ç»’é‡150g+ç¾½ç»’æœæˆ–ç¾Šæ¯›å¤§è¡£</div>
                    `;
                }

                $('advice-content').innerHTML = `
                    <div style="margin-bottom:10px;"><b>ğŸ¨ é¢œè‰²å»ºè®®ï¼š</b>${colorAdvice}</div>
                    ${layers}
                    <div style="margin-top:10px; font-size:0.8rem; opacity:0.8;">* ä¾æ®ä¸‰å±‚ç©¿è¡£æ³•ï¼šå†…æ’æ±—ã€ä¸­ä¿æš–ã€å¤–é˜²é£</div>
                `;

                // å¯åŠ¨èƒŒæ™¯åŠ¨ç”»
                setWeatherEffect(cur.lang_zh ? cur.lang_zh[0].value : cur.weatherDesc[0].value, cur.windspeedKmph, 0);
            });
    };
</script>
</body>
</html>
