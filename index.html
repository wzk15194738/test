<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°”è±¡å®éªŒå®¤ 7.0 - iOS çµæ„Ÿç‰ˆ</title>
    <style>
        /* --- iOS è®¾è®¡è§„èŒƒå˜é‡ --- */
        :root {
            --ios-bg: rgba(255, 255, 255, 0.2);
            --ios-blur: blur(25px);
            --ios-radius: 22px;
            --text-main: #ffffff;
            --text-sub: rgba(255, 255, 255, 0.7);
        }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-main);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: flex-start;
            /* é»˜è®¤èƒŒæ™¯å›¾ï¼ˆæ™´å¤©ï¼‰ */
            background: url('https://images.unsplash.com/photo-1516912481808-34061f8c6301?auto=format&fit=crop&w=1000&q=80') center/cover no-repeat fixed;
            transition: background 0.8s ease-in-out;
        }

        /* é®ç½©å±‚è®©æ–‡å­—æ›´æ¸…æ™° */
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.2); z-index: -1;
        }

        .container {
            width: 92%; max-width: 500px; padding: 25px 0;
            display: flex; flex-direction: column; gap: 15px;
        }

        .header { text-align: center; margin-bottom: 10px; }
        .header h1 { font-size: 2rem; font-weight: 500; margin: 0; }
        .header p { font-size: 0.9rem; color: var(--text-sub); margin: 5px 0; }

        /* --- iOS å¡ç‰‡æ ·å¼ --- */
        .ios-card {
            background: var(--ios-bg);
            backdrop-filter: var(--ios-blur);
            -webkit-backdrop-filter: var(--ios-blur);
            border-radius: var(--ios-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 3:1:2 æ¸©åº¦å¸ƒå±€ */
        .temp-row { display: flex; gap: 10px; align-items: stretch; }
        .col-left { flex: 3; display: flex; flex-direction: column; gap: 8px; }
        .col-mid { flex: 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1); }
        .col-right { flex: 2; display: flex; flex-direction: column; gap: 8px; padding-left: 5px; }

        .label { font-size: 0.75rem; color: var(--text-sub); }
        .val { font-size: 1rem; font-weight: 600; }
        .big-val { font-size: 1.6rem; color: #ffdb58; }

        /* ç½‘æ ¼å¸ƒå±€ */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .grid-item { display: flex; flex-direction: column; gap: 4px; }

        /* ç©¿æ­å»ºè®®åˆ†è¡Œå±•ç¤º */
        .advice-list { display: flex; flex-direction: column; gap: 10px; font-size: 0.9rem; line-height: 1.4; }
        .advice-item { padding-left: 12px; border-left: 3px solid #64d2ff; }
        .advice-tag { font-weight: bold; color: #64d2ff; display: block; margin-bottom: 2px; }

        /* æŒ‰é’® */
        button {
            background: #ffffff; color: #000; border: none;
            padding: 16px; border-radius: var(--ios-radius);
            font-size: 1rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        button:active { transform: scale(0.96); }

        #status { text-align: center; font-size: 0.8rem; color: var(--text-sub); margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 id="cityName">æ°”è±¡å®éªŒå®¤</h1>
        <p id="sunTime">ç­‰å¾…æ•°æ®åŒæ­¥...</p>
    </div>

    <div class="ios-card temp-row">
        <div class="col-left">
            <div class="grid-item"><span class="label">æ—©é—´ä½“æ„Ÿ</span><span class="val" id="t-morn">--</span></div>
            <div class="grid-item"><span class="label">åˆé—´ä½“æ„Ÿ</span><span class="val" id="t-noon">--</span></div>
            <div class="grid-item"><span class="label">æ™šé—´ä½“æ„Ÿ</span><span class="val" id="t-eve">--</span></div>
        </div>
        <div class="col-mid">
            <span class="label">å…¨å¤©å¹³å‡</span>
            <span class="big-val" id="t-all-avg">--</span>
        </div>
        <div class="col-right">
            <div class="grid-item"><span class="label">ç™½å¤©ä½“æ„Ÿ</span><span class="val" id="t-day-avg">--</span></div>
            <div class="grid-item"><span class="label">å¤œé—´ä½“æ„Ÿ</span><span class="val" id="t-night-avg">--</span></div>
        </div>
    </div>

    <div class="ios-card data-grid">
        <div class="grid-item">
            <span class="label">æ¹¿åº¦ (æœ€ä½³ 45-65%)</span>
            <span class="val" id="hum-val">--</span>
        </div>
        <div class="grid-item">
            <span class="label">æ—¥ç…§å¼ºåº¦ (0-11+)</span>
            <span class="val" id="uv-val">--</span>
        </div>
    </div>

    <div class="ios-card">
        <div class="label" style="margin-bottom:12px;">é£åŠ›è§‚æµ‹ (å•ä½: m/s)</div>
        <div class="data-grid">
            <div class="grid-item"><span class="label">å½“å‰é£é€Ÿé£å‘</span><span class="val" id="wind-now">--</span></div>
            <div class="grid-item"><span class="label">å…¨å¤©å¹³å‡é€Ÿ/å‘</span><span class="val" id="wind-all">--</span></div>
            <div class="grid-item"><span class="label">ç™½å¤©å¹³å‡é€Ÿ/å‘</span><span class="val" id="wind-day">--</span></div>
            <div class="grid-item"><span class="label">å¤œé—´å¹³å‡é€Ÿ/å‘</span><span class="val" id="wind-night">--</span></div>
        </div>
    </div>

    <div class="ios-card advice-list" id="advice-content">
        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œè·å–ä»Šæ—¥ä¸“ä¸šç©¿æ­å»ºè®®ã€‚
    </div>

    <button id="syncBtn">åŒæ­¥å®æ—¶æ°”è±¡æ•°æ®</button>
    <div id="status">æ•°æ®æ¥æº: å…¨çƒæ°”è±¡è§‚æµ‹ç«™</div>
</div>

<script>
    const $ = (id) => document.getElementById(id);

    const cityMap = { "Wuxi": "æ— é”¡", "Shanghai": "ä¸Šæµ·", "Beijing": "åŒ—äº¬", "Suzhou": "è‹å·", "Nanjing": "å—äº¬", "Hangzhou": "æ­å·" };
    const windMap = { "N": "åŒ—é£", "S": "å—é£", "E": "ä¸œé£", "W": "è¥¿é£", "NE": "ä¸œåŒ—é£", "NW": "è¥¿åŒ—é£", "SE": "ä¸œå—é£", "SW": "è¥¿å—é£", "NNE": "ä¸œåŒ—ååŒ—", "ENE": "ä¸œåŒ—åä¸œ", "ESE": "ä¸œå—åä¸œ", "SSE": "ä¸œå—åå—", "SSW": "è¥¿å—åå—", "WSW": "è¥¿å—åè¥¿", "WNW": "è¥¿åŒ—åè¥¿", "NNW": "è¥¿åŒ—ååŒ—" };

    const toMS = (kmh) => (parseInt(kmh) * 0.278).toFixed(1);

    function updateBackground(desc) {
        let bgUrl = 'https://images.unsplash.com/photo-1516912481808-34061f8c6301?auto=format&fit=crop&w=1000&q=80'; // é»˜è®¤æ™´å¤©
        if (desc.includes("é›¨")) bgUrl = 'https://images.unsplash.com/photo-1534274988757-a28bf1a57c17?auto=format&fit=crop&w=1000&q=80';
        else if (desc.includes("äº‘") || desc.includes("é˜´")) bgUrl = 'https://images.unsplash.com/photo-1534088568595-a066f7105a21?auto=format&fit=crop&w=1000&q=80';
        document.body.style.background = `url('${bgUrl}') center/cover no-repeat fixed`;
    }

    $('syncBtn').onclick = () => {
        $('syncBtn').innerText = "åŒæ­¥ä¸­...";
        fetch('https://wttr.in/?format=j1')
            .then(res => res.json())
            .then(data => {
                const cur = data.current_condition[0];
                const weather = data.weather[0];
                const hourly = weather.hourly;
                const area = data.nearest_area[0].areaName[0].value;

                // åŸå¸‚ä¸èƒŒæ™¯
                $('cityName').innerText = cityMap[area] || area;
                $('sunTime').innerText = `ğŸŒ… ${weather.astronomy[0].sunrise}  ğŸŒ‡ ${weather.astronomy[0].sunset}`;
                updateBackground(cur.lang_zh ? cur.lang_zh[0].value : cur.weatherDesc[0].value);

                // æ¸©åº¦
                $('t-morn').innerText = hourly[3].FeelsLikeC + "Â°";
                $('t-noon').innerText = hourly[4].FeelsLikeC + "Â°";
                $('t-eve').innerText = hourly[7].FeelsLikeC + "Â°";
                $('t-all-avg').innerText = (hourly.reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 8).toFixed(1) + "Â°";
                $('t-day-avg').innerText = (hourly.slice(3, 7).reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 4).toFixed(1) + "Â°";
                $('t-night-avg').innerText = (hourly.slice(0, 3).concat(hourly[7]).reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 4).toFixed(1) + "Â°";

                // æ¹¿åº¦/UV
                $('hum-val').innerText = `${cur.humidity}% (${cur.humidity >= 45 && cur.humidity <= 65 ? 'æœ€ä½³' : 'å¤±è¡¡'})`;
                $('uv-val').innerText = `${cur.uvIndex} (${cur.uvIndex > 3 ? 'å»ºè®®é˜²æ™’' : 'å®‰å…¨'})`;

                // é£åŠ›è§‚æµ‹è¡¥å…¨
                const getWindStr = (h) => `${toMS(h.windspeedKmph)} ${windMap[h.winddir16Point] || h.winddir16Point}`;
                $('wind-now').innerText = getWindStr(cur);
                $('wind-all').innerText = getWindStr(hourly[4]); // å–åˆé—´ä»£è¡¨å…¨å¤©è¶‹åŠ¿
                $('wind-day').innerText = getWindStr(hourly[4]);
                $('wind-night').innerText = getWindStr(hourly[7]);

                // ç©¿æ­å»ºè®®
                const f = parseInt(cur.FeelsLikeC);
                let col = f > 22 ? "æµ…è‰²ç³»(ç™½/ç±³/æµ…è“)" : "æ·±è‰²ç³»(å’–/é»‘/è—è“)";
                let l1, l2, l3;
                if(f >= 25) { l1="å‡‰çˆ½çŸ­è¢–/çœŸä¸è¡«"; l2="è–„é˜²æ™’è¡«(å®¤å†…)"; l3="å•å±‚é£è¡£(å¤‡ç”¨)"; }
                else if(f >= 15) { l1="é•¿è¢–æ£‰è´¨æ‰“åº•"; l2="ç¾Šæ¯›èƒŒå¿ƒ/è–„å«è¡£"; l3="ä¼‘é—²è¥¿è£…/å·¥è£…å¤–å¥—"; }
                else { l1="å¾·ç»’å‘çƒ­å†…è¡£"; l2="åŠ ç»’æ¯›è¡£/åšå¸½è¡«"; l3="é•¿æ¬¾ç¾½ç»’æœ/ç¾Šç»’å¤§è¡£"; }

                $('advice-content').innerHTML = `
                    <div class="advice-item"><span class="advice-tag">ğŸ¨ é…è‰²å»ºè®®</span>${col}ï¼Œè§†è§‰æ›´å’Œè°ã€‚</div>
                    <div class="advice-item"><span class="advice-tag">ğŸ‘• æ’æ±—å±‚ (è´´èº«)</span>${l1}ï¼Œä¿æŒçš®è‚¤å¹²çˆ½ã€‚</div>
                    <div class="advice-item"><span class="advice-tag">ğŸ§¶ ä¿æš–å±‚ (ä¸­é—´)</span>${l2}ï¼Œæœ‰æ•ˆé”ä½çƒ­é‡ã€‚</div>
                    <div class="advice-item"><span class="advice-tag">ğŸ›¡ï¸ é˜²é£å±‚ (å¤–å¥—)</span>${l3}ï¼Œé˜»æŒ¡å¤–éƒ¨å¯’æ°”ã€‚</div>
                    <div class="advice-item"><span class="advice-tag">ğŸ‘Ÿ é‹å±¥é…ä»¶</span>${f > 20 ? 'é€æ°”è¿åŠ¨é‹ + é®é˜³å¸½' : 'åŠ ç»’çš®é‹ + ä¿æš–å›´å·¾'}ã€‚</div>
                `;

                $('syncBtn').innerText = "æ•°æ®åŒæ­¥æˆåŠŸ";
            })
            .catch(() => { $('syncBtn').innerText = "åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"; });
    };
</script>
</body>
</html>
