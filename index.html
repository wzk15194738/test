<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°”è±¡å®éªŒå®¤ 5.0 - ä¸“ä¸šè§‚æµ‹ç‰ˆ</title>
    <style>
        :root { --primary: #00d2ff; --glass: rgba(255, 255, 255, 0.15); }
        body { 
            margin: 0; min-height: 100vh;
            background: linear-gradient(160deg, #0f2027 0%, #203a43 50%, #2c5364 100%); 
            color: white; font-family: system-ui, -apple-system, sans-serif;
            display: flex; justify-content: center; align-items: center; padding: 20px;
        }
        .container {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 24px;
            padding: 25px; width: 100%; max-width: 600px; box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }
        h2 { text-align: center; margin: 0 0 20px 0; font-weight: 300; letter-spacing: 1px; }
        .section-title { font-size: 0.8rem; color: var(--primary); margin: 15px 0 8px 5px; text-transform: uppercase; letter-spacing: 1px; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .item { background: rgba(0,0,0,0.25); padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .label { font-size: 0.75rem; color: #aaa; display: block; }
        .val { font-size: 1rem; font-weight: 500; margin-top: 4px; display: block; color: #fff; }
        .advice-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; margin-top: 15px; line-height: 1.6; font-size: 0.9rem; }
        button {
            width: 100%; background: linear-gradient(to right, #00d2ff, #3a7bd5);
            border: none; padding: 14px; border-radius: 12px; color: white;
            font-weight: bold; margin-top: 20px; cursor: pointer; transition: 0.3s;
        }
        button:active { transform: scale(0.98); }
        .highlight { color: #f1c40f; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="cityName">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŒæ­¥æ°”è±¡</h2>
    
    <div id="weatherContent" style="display:none;">
        <div class="section-title">ğŸ•’ å¤šæ—¶æ®µä½“æ„Ÿæ¸©åº¦</div>
        <div class="data-grid">
            <div class="item"><span class="label">æ—©æ™¨ (06-09)</span><span class="val" id="tempMorning">--</span></div>
            <div class="item"><span class="label">ä¸­åˆ (12-15)</span><span class="val" id="tempNoon">--</span></div>
            <div class="item"><span class="label">æ™šä¸Š (18-21)</span><span class="val" id="tempEvening">--</span></div>
            <div class="item"><span class="label">ç™½å¤©å¹³å‡</span><span class="val" id="tempDayAvg">--</span></div>
            <div class="item" style="grid-column: span 2;"><span class="label">æ—¥è½å (Night)</span><span class="val" id="tempAfterDark">--</span></div>
        </div>

        <div class="section-title">ğŸ’§ æ¹¿åº¦ä¸å…‰ç…§</div>
        <div class="data-grid">
            <div class="item"><span class="label">ç©ºæ°”æ¹¿åº¦ (æœ€ä½³ 45-65%)</span><span class="val" id="humidity">--</span></div>
            <div class="item"><span class="label">æ—¥ç…§å¼ºåº¦ (0-11+ æŒ‡æ•°)</span><span class="val" id="uv">--</span></div>
        </div>

        <div class="section-title">ğŸŒ¬ï¸ é£åŠ›è§‚æµ‹ (å•ä½: m/s)</div>
        <div class="data-grid">
            <div class="item"><span class="label">å½“å‰é£é€Ÿ/é£å‘</span><span class="val" id="windNow">--</span></div>
            <div class="item"><span class="label">å…¨å¤©å¹³å‡é£é€Ÿ</span><span class="val" id="windAllAvg">--</span></div>
            <div class="item"><span class="label">ç™½å¤©å¹³å‡ (é€Ÿ/å‘)</span><span class="val" id="windDay">--</span></div>
            <div class="item"><span class="label">å¤œé—´å¹³å‡ (é€Ÿ/å‘)</span><span class="val" id="windNight">--</span></div>
        </div>

        <div class="section-title">â˜€ï¸ æ—¥ç…§ä¸å»ºè®®</div>
        <div class="item"><span class="label">æ—¥ç…§æ—¶é—´ (æ—¥å‡º/æ—¥è½)</span><span class="val" id="sunTime">--</span></div>
        <div class="advice-box" id="adviceText"></div>
    </div>

    <button id="updateBtn">åŒæ­¥å®æ—¶æ°”è±¡æ•°æ®</button>
</div>

<script>
    const $ = (id) => document.getElementById(id);

    // é£å‘è½¬æ¢å™¨
    const windDirMap = {
        "N": "åŒ—é£", "S": "å—é£", "E": "ä¸œé£", "W": "è¥¿é£",
        "NE": "ä¸œåŒ—é£", "NW": "è¥¿åŒ—é£", "SE": "ä¸œå—é£", "SW": "è¥¿å—é£",
        "NNE": "ä¸œåŒ—ååŒ—é£", "ENE": "ä¸œåŒ—åä¸œé£", "ESE": "ä¸œå—åä¸œé£", "SSE": "ä¸œå—åå—é£",
        "SSW": "è¥¿å—åå—é£", "WSW": "è¥¿å—åè¥¿é£", "WNW": "è¥¿åŒ—åè¥¿é£", "NNW": "è¥¿åŒ—ååŒ—é£"
    };

    // km/h è½¬ m/s è½¬æ¢å™¨
    const toMS = (kmh) => (parseInt(kmh) * 0.278).toFixed(1);

    $('updateBtn').onclick = () => {
        $('updateBtn').innerText = "ğŸ›°ï¸ æ•°æ®åŒæ­¥ä¸­...";
        
        fetch('https://wttr.in/?format=j1')
            .then(res => res.json())
            .then(data => {
                const cur = data.current_condition[0];
                const weather = data.weather[0];
                const hourly = weather.hourly;
                const astro = weather.astronomy[0];

                // 1. è®¾ç½®æ ‡é¢˜
                $('cityName').innerText = `ğŸ“ ${data.nearest_area[0].areaName[0].value}`;

                // 2. ä½“æ„Ÿæ¸©åº¦é€»è¾‘ (æ ¹æ®å°æ—¶æ•°æ®æå–)
                // æ—©(09:00), ä¸­(12:00), æ™š(21:00)
                $('tempMorning').innerText = hourly[3].FeelsLikeC + "Â°C";
                $('tempNoon').innerText = hourly[4].FeelsLikeC + "Â°C";
                $('tempEvening').innerText = hourly[7].FeelsLikeC + "Â°C";
                
                // è®¡ç®—ç™½å¤©å¹³å‡ä½“æ„Ÿ (09:00 - 18:00)
                const dayTemps = [hourly[3], hourly[4], hourly[5], hourly[6]];
                const dayAvg = (dayTemps.reduce((s, x) => s + parseInt(x.FeelsLikeC), 0) / 4).toFixed(1);
                $('tempDayAvg').innerText = dayAvg + "Â°C";
                $('tempAfterDark').innerText = hourly[0].FeelsLikeC + "Â°C";

                // 3. æ¹¿åº¦ä¸UV
                $('humidity').innerText = `${cur.humidity}% ${cur.humidity >= 45 && cur.humidity <= 65 ? 'ğŸ‘' : 'âš ï¸'}`;
                $('uv').innerText = `${cur.uvIndex} (${cur.uvIndex >= 3 ? 'å»ºè®®é˜²æ™’' : 'æ— éœ€é˜²æ™’'})`;

                // 4. é£é€Ÿé€»è¾‘ (m/s)
                $('windNow').innerText = `${toMS(cur.windspeedKmph)} m/s (${windDirMap[cur.winddir16Point] || cur.winddir16Point})`;
                
                // å…¨å¤©å¹³å‡
                const allWind = (hourly.reduce((s, x) => s + parseInt(x.windspeedKmph), 0) / 8);
                $('windAllAvg').innerText = toMS(allWind) + " m/s";

                // ç™½å¤©(09-18) vs å¤œé—´(21-06)
                const dWind = hourly.slice(3, 7);
                const nWind = [hourly[7], hourly[0], hourly[1], hourly[2]];
                
                $('windDay').innerText = `${toMS(dWind[0].windspeedKmph)} m/s (${windDirMap[dWind[0].winddir16Point]})`;
                $('windNight').innerText = `${toMS(nWind[0].windspeedKmph)} m/s (${windDirMap[nWind[0].winddir16Point]})`;

                // 5. æ—¥ç…§
                $('sunTime').innerText = `ğŸŒ… ${astro.sunrise} / ğŸŒ‡ ${astro.sunset}`;

                // 6. è¯¦ç»†ç©¿è¡£å»ºè®®
                const feels = parseInt(cur.FeelsLikeC);
                let clothes = "", pants = "", shoes = "", acc = "";

                if(feels >= 28) {
                    clothes = "çŸ­è¢–ã€å†°ä¸Tæ¤"; pants = "çŸ­è£¤ã€å‡‰çˆ½è¿åŠ¨è£¤"; shoes = "å‡‰é‹ã€é€æ°”æ¿é‹"; acc = "é˜²æ™’å¸½ã€å¢¨é•œ";
                } else if(feels >= 18) {
                    clothes = "é•¿è¢–è¡¬è¡«ã€å«è¡£"; pants = "ç‰›ä»”è£¤ã€ä¼‘é—²é•¿è£¤"; shoes = "è¿åŠ¨é‹ã€å¸†å¸ƒé‹"; acc = "è–„æ¬¾é˜²æ™’å¤–å¥—";
                } else if(feels >= 10) {
                    clothes = "ç¾Šæ¯›è¡«ã€å¤¹å…‹å¤–å¥—"; pants = "åšæ£‰è£¤ã€å·¥è£…è£¤"; shoes = "çš®é‹ã€åŠ åšè¿åŠ¨é‹"; acc = "è–„å›´å·¾ã€å£ç½©";
                } else {
                    clothes = "ç¾½ç»’æœã€ä¿æš–å†…è¡£"; pants = "åŠ ç»’é•¿è£¤ã€ä¿æš–è£¤"; shoes = "åŠ ç»’é´å­ã€é«˜å¸®é‹"; acc = "åšå›´å·¾ã€æ‰‹å¥—ã€æš–å®å®";
                }

                $('adviceText').innerHTML = `
                    <b>ğŸ§¥ ä¸Šè£…å»ºè®®ï¼š</b> ${clothes}<br>
                    <b>ğŸ‘– ä¸‹è£…å»ºè®®ï¼š</b> ${pants}<br>
                    <b>ğŸ‘Ÿ é‹å±¥å»ºè®®ï¼š</b> ${shoes}<br>
                    <b>ğŸ§£ é…ä»¶å»ºè®®ï¼š</b> ${acc}
                `;

                $('weatherContent').style.display = "block";
                $('updateBtn').innerText = "âœ… æ•°æ®åŒæ­¥æˆåŠŸ";
            })
            .catch(err => {
                $('cityName').innerText = "âŒ åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
                $('updateBtn').innerText = "é‡æ–°å°è¯•åŒæ­¥";
            });
    };
</script>
</body>
</html>
