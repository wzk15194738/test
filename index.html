<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“ä¸šæ°”è±¡ä»ªè¡¨ç›˜ 4.0</title>
    <style>
        :root {
            --primary: #00d2ff;
            --glass: rgba(255, 255, 255, 0.2);
        }
        body { 
            margin: 0; 
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); 
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex; justify-content: center; align-items: center;
        }
        .container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        h2 { text-align: center; margin-bottom: 25px; letter-spacing: 2px; }
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 10px;
            border-left: 3px solid var(--primary);
        }
        .label { font-size: 0.8rem; color: #ccc; display: block; }
        .val { font-size: 1.1rem; font-weight: bold; margin-top: 5px; display: block; }
        button {
            width: 100%;
            background: var(--primary);
            border: none;
            padding: 12px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover { filter: brightness(1.2); }
        #status { text-align: center; font-size: 0.8rem; margin-top: 10px; color: #add8e6; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="cityName">å®æ—¶æ°”è±¡è§‚æµ‹ç«™</h2>
    
    <div class="data-grid" id="weatherBox" style="display: none;">
        <div class="item"><span class="label">ä½“æ„Ÿæ¸©åº¦</span><span class="val" id="feelsLike">--</span></div>
        <div class="item"><span class="label">ç©ºæ°”æ¹¿åº¦</span><span class="val" id="humidity">--</span></div>
        <div class="item"><span class="label">æµ·æ‹”é«˜åº¦</span><span class="val" id="alt">--</span></div>
        <div class="item"><span class="label">æ—¥ç…§å¼ºåº¦(UV)</span><span class="val" id="uv">--</span></div>
        <div class="item"><span class="label">å®æ—¶é£é€Ÿ/é£å‘</span><span class="val" id="wind">--</span></div>
        <div class="item"><span class="label">å…¨å¤©å¹³å‡é£é€Ÿ</span><span class="val" id="avgWind">--</span></div>
        <div class="item" style="grid-column: span 2;"><span class="label">æ—¥ç…§æ—¶é—´ (Sunrise/Set)</span><span class="val" id="sunTime">--</span></div>
        <div class="item" style="grid-column: span 2;"><span class="label">ç©¿è¡£ä¸å‡ºè¡Œå»ºè®®</span><span class="val" id="advice">--</span></div>
    </div>

    <button id="updateBtn">è·å–å½“å‰ä½ç½®ç²¾å‡†æ°”è±¡</button>
    <div id="status">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ¢æµ‹</div>
</div>

<script>
    const $ = (id) => document.getElementById(id);

    $('updateBtn').onclick = () => {
        $('status').innerText = "ğŸ›°ï¸ æ­£åœ¨è§£ç å«æ˜Ÿæ•°æ®...";
        
        // è‡ªåŠ¨è¯†åˆ« IP å®šä½
        fetch('https://wttr.in/?format=j1')
            .then(res => res.json())
            .then(data => {
                const cur = data.current_condition[0];
                const area = data.nearest_area[0];
                const astro = data.weather[0].astronomy[0];
                const weatherDay = data.weather[0];

                // 1. åŸå¸‚ä¸æ ‡é¢˜
                $('cityName').innerText = `${area.areaName[0].value} Â· ${area.region[0].value}`;
                
                // 2. å¡«å……æ ¸å¿ƒæ•°æ®
                $('feelsLike').innerText = cur.FeelsLikeC + "Â°C";
                $('humidity').innerText = cur.humidity + "%";
                $('alt').innerText = area.elevation + " ç±³";
                $('uv').innerText = cur.uvIndex + " (æŒ‡æ•°)";
                
                // 3. é£åŠ› (å®æ—¶ä¸æ–¹å‘)
                $('wind').innerText = `${cur.windspeedKmph} km/h (${cur.winddir16Point})`;
                
                // 4. å¹³å‡é£é€Ÿ (è®¡ç®—å…¨å¤© 8 ä¸ªæ—¶æ®µçš„å¹³å‡å€¼)
                const hourly = weatherDay.hourly;
                const avg = (hourly.reduce((acc, h) => acc + parseInt(h.windspeedKmph), 0) / hourly.length).toFixed(1);
                $('avgWind').innerText = avg + " km/h";

                // 5. æ—¥ç…§æ—¶é—´
                $('sunTime').innerText = `ğŸŒ… ${astro.sunrise} / ğŸŒ‡ ${astro.sunset}`;

                // 6. ç©¿è¡£å»ºè®®é€»è¾‘
                let advice = "";
                const temp = parseInt(cur.FeelsLikeC);
                if(temp > 28) advice = "ğŸ‘• å¤©æ°”ç‚çƒ­ï¼Œå»ºè®®çŸ­è¢–å‡‰é‹ï¼Œæ³¨æ„é˜²æ™’ã€‚";
                else if(temp > 18) advice = "ğŸ§¥ æ°”æ¸©èˆ’é€‚ï¼Œå»ºè®®é•¿è¢–æˆ–è–„å¤–å¥—ã€‚";
                else if(temp > 10) advice = "ğŸ§¥ è¾ƒå‡‰ï¼Œå»ºè®®é£è¡£æˆ–æ¯›è¡£ã€‚";
                else advice = "ğŸ§£ å¯’å†·ï¼Œè¯·ç©¿ç¾½ç»’æœæˆ–åšå¤§è¡£ã€‚";
                
                if(parseInt(cur.uvIndex) > 5) advice += " ğŸ•¶ï¸ ç´«å¤–çº¿å¼ºï¼Œæˆ´å¥½å¢¨é•œã€‚";
                $('advice').innerText = advice;

                // æ˜¾ç¤ºç»“æœ
                $('weatherBox').style.display = "grid";
                $('status').innerText = "âœ… æ•°æ®å·²å®æ—¶åŒæ­¥";
            })
            .catch(err => {
                $('status').innerText = "âŒ æ¢æµ‹å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–å…³é—­ VPN";
                console.error(err);
            });
    };
</script>

</body>
</html>
