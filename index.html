<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­—ç¬¦æ°”è±¡ç«™ 8.0</title>
    <style>
        /* ã€ğŸ¨ é¢œè‰²è°ƒèŠ‚æŒ‡å—ã€‘
           æƒ³è¦æ¢åº•è‰²ï¼Ÿæ”¹ä¸‹é¢çš„ --bg-color
           æƒ³è¦æ¢æ–‡å­—é¢œè‰²ï¼Ÿæ”¹ --text-main
        */
        :root {
            --bg-color: #1a1a1a;        /* èƒŒæ™¯ï¼šæ·±ç°è‰² */
            --text-main: #ffffff;      /* ä¸»æ–‡å­—ï¼šç™½è‰² */
            --accent: #00d2ff;         /* å¼ºè°ƒè‰²ï¼šå¤©è“è‰² */
            --ios-radius: 20px;        /* é€‰é¡¹æ¡†åœ†è§’å¤§å° */
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: "Courier New", Courier, monospace; /* å¿…é¡»ç”¨ç­‰å®½å­—ä½“ï¼Œå­—ç¬¦æ‰å¯¹é½ */
            display: flex; justify-content: center;
            overflow-x: hidden;
        }

        /* ã€ğŸ¥ å­—ç¬¦èƒŒæ™¯ä½ç½®ã€‘
           #ascii-bg æ§åˆ¶èƒŒæ™¯å­—ç¬¦ã€‚
           opacity: 0.2 è¡¨ç¤ºé€æ˜åº¦ï¼Œæ•°å­—è¶Šå°è¶Šæš—ï¼Œä¸å¹²æ‰°é˜…è¯»ã€‚
        */
        #ascii-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; white-space: pre; font-size: 12px;
            line-height: 12px; color: rgba(255,255,255,0.15);
            pointer-events: none; user-select: none;
        }

        .container {
            width: 90%; max-width: 500px; padding: 30px 0;
            display: flex; flex-direction: column; 
            gap: 20px; /* ã€ğŸ“ é—´è·ã€‘è°ƒæ•´é€‰é¡¹æ¡†ä¹‹é—´çš„å‚ç›´è·ç¦» */
        }

        /* ã€ğŸ“¦ é€‰é¡¹æ¡†è®¾è®¡å‚æ•°ã€‘
           background: æ§åˆ¶æ¡†çš„é€æ˜åº¦ (0.1 æ˜¯ 10% é€æ˜)
           backdrop-filter: ç£¨ç ‚ç»ç’ƒæ•ˆæœï¼Œæ‰‹æœºç«¯å¦‚æœå¡å¯ä»¥åˆ æ‰è¿™è¡Œ
        */
        .ios-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: var(--ios-radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ã€ğŸ“ å¸ƒå±€å‚æ•°ã€‘
           flex: 3 è¡¨ç¤ºå  3 ä»½ç©ºé—´ã€‚æƒ³è°ƒå®½çª„å°±æ”¹è¿™é‡Œçš„æ•°å­—ã€‚
        */
        .temp-row { display: flex; gap: 10px; }
        .col-left { flex: 3; }   /* å·¦ä¾§ï¼šæ—©ä¸­æ™š */
        .col-mid  { flex: 1.5; border-left: 1px solid rgba(255,255,255,0.1); text-align: center; } 
        .col-right { flex: 2; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 10px; }

        .label { font-size: 0.7rem; color: #888; margin-bottom: 4px; display: block; }
        .val { font-size: 0.95rem; font-weight: bold; }

        /* ç½‘æ ¼ï¼šç”¨äºé£åŠ›è§‚æµ‹ */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        button {
            background: var(--accent); color: #000; border: none;
            padding: 18px; border-radius: var(--ios-radius);
            font-weight: bold; cursor: pointer; font-size: 1rem;
        }

        /* å¼ºåˆ¶æ¢è¡Œï¼šå¦‚æœæ–‡å­—å¤ªé•¿ï¼Œä¼šè‡ªåŠ¨æŠ˜è¡Œ */
        .break-word { word-wrap: break-word; white-space: normal; }
    </style>
</head>
<body>

<div id="ascii-bg"></div>

<div class="container">
    <div style="text-align: center;">
        <h1 id="cityName" style="margin:0;">è½½å…¥ä¸­...</h1>
        <p id="sunTime" class="label" style="margin-top:5px;">--:--</p>
    </div>

    <div class="ios-card temp-row">
        <div class="col-left">
            <span class="label">ğŸŒ… æ—©é—´ä½“æ„Ÿ</span><span class="val" id="t-morn">--</span><br><br>
            <span class="label">â˜€ï¸ åˆé—´ä½“æ„Ÿ</span><span class="val" id="t-noon">--</span><br><br>
            <span class="label">ğŸŒ™ æ™šé—´ä½“æ„Ÿ</span><span class="val" id="t-eve">--</span>
        </div>
        <div class="col-mid">
            <span class="label">å…¨å¤©å¹³å‡</span>
            <div id="t-all-avg" style="font-size: 1.8rem; color: var(--accent); margin-top:15px;">--</div>
        </div>
        <div class="col-right">
            <span class="label">ç™½å¤©å¹³å‡</span><span class="val" id="t-day-avg">--</span><br><br>
            <span class="label">å¤œé—´å¹³å‡</span><span class="val" id="t-night-avg">--</span>
        </div>
    </div>

    <div class="ios-card">
        <span class="label" style="margin-bottom:15px;">ğŸŒ¬ï¸ é£åŠ›è§‚æµ‹ (m/s)</span>
        <div class="data-grid">
            <div class="grid-item"><span class="label">å½“å‰</span><span class="val" id="w-now">--</span></div>
            <div class="grid-item"><span class="label">å…¨å¤©</span><span class="val" id="w-all">--</span></div>
            <div class="grid-item"><span class="label">ç™½å¤©</span><span class="val" id="w-day">--</span></div>
            <div class="grid-item"><span class="label">å¤œé—´</span><span class="val" id="w-night">--</span></div>
        </div>
    </div>

    <div class="ios-card data-grid">
        <div class="grid-item"><span class="label">æ¹¿åº¦ (æœ€ä½³45-65%)</span><span class="val" id="hum">--</span></div>
        <div class="grid-item"><span class="label">æ—¥ç…§å¼ºåº¦ (0-11+)</span><span class="val" id="uv">--</span></div>
    </div>

    <button id="syncBtn">åŒæ­¥æ•°æ® & åˆ·æ–°å­—ç¬¦èƒŒæ™¯</button>
</div>

<script>
    const $ = (id) => document.getElementById(id);

    // ã€ğŸ”¤ å­—ç¬¦è‰ºæœ¯åº“ã€‘
    const arts = {
        sunny: `
            \\   |   /
             .-''' -.
          - (        ) -
             '-...-'
            /   |   \\
        `,
        cloudy: `
                 .--.
              .-(    ).
             (___.__)__)
        `,
        rain_light: `
            '  '  '  '
             '  '  '  '
            '  '  '  '
        `,
        rain_heavy: `
            /  /  /  /
           /  /  /  /
          /  /  /  /
        `,
        thunder: `
            âš¡  /  âš¡
              /  
             /   âš¡
        `,
        wind: `
            ~~~~ ~~~~
              ~~~~ ~~~~
            ~~~~ ~~~~
        `
    };

    // ç»˜åˆ¶å…¨å±èƒŒæ™¯
    function drawArt(type, isWindy) {
        const bg = $('ascii-bg');
        let pattern = arts[type] || arts.cloudy;
        if(isWindy) pattern += arts.wind; // å åŠ é£
        
        // é‡å¤å¡«å……æ•´ä¸ªå±å¹•
        bg.innerText = (pattern + "\n").repeat(30);
    }

    const cityMap = { "Wuxi": "æ— é”¡", "Shanghai": "ä¸Šæµ·", "Beijing": "åŒ—äº¬" };
    const windMap = { "N": "åŒ—", "S": "å—", "E": "ä¸œ", "W": "è¥¿", "NE": "ä¸œåŒ—", "NW": "è¥¿åŒ—", "SE": "ä¸œå—", "SW": "è¥¿å—" };

    $('syncBtn').onclick = () => {
        fetch('https://wttr.in/?format=j1')
            .then(res => res.json())
            .then(data => {
                const cur = data.current_condition[0];
                const weather = data.weather[0];
                const hourly = weather.hourly;
                
                // --- ã€âœï¸ ä¿®æ”¹æ˜¾ç¤ºæ–‡å­—ã€‘ ---
                // æƒ³æ”¹æ ‡é¢˜ï¼Ÿçœ‹ä¸‹é¢è¿™è¡Œ
                $('cityName').innerText = cityMap[data.nearest_area[0].areaName[0].value] || data.nearest_area[0].areaName[0].value;
                $('sunTime').innerText = `æ—¥å‡º ${weather.astronomy[0].sunrise} | æ—¥è½ ${weather.astronomy[0].sunset}`;

                // æ¸©åº¦å¡«ç©º
                $('t-morn').innerText = hourly[3].FeelsLikeC + "Â°";
                $('t-noon').innerText = hourly[4].FeelsLikeC + "Â°";
                $('t-eve').innerText = hourly[7].FeelsLikeC + "Â°";
                $('t-all-avg').innerText = (hourly.reduce((s,x)=>s+parseInt(x.FeelsLikeC),0)/8).toFixed(1) + "Â°";
                $('t-day-avg').innerText = (hourly.slice(3,7).reduce((s,x)=>s+parseInt(x.FeelsLikeC),0)/4).toFixed(1) + "Â°";
                $('t-night-avg').innerText = (hourly.slice(0,3).concat(hourly[7]).reduce((s,x)=>s+parseInt(x.FeelsLikeC),0)/4).toFixed(1) + "Â°";

                // é£åŠ›è§‚æµ‹ (m/s)
                const f = (h) => (h.windspeedKmph * 0.278).toFixed(1) + " " + (windMap[h.winddir16Point] || h.winddir16Point);
                $('w-now').innerText = f(cur);
                $('w-all').innerText = f(hourly[4]);
                $('w-day').innerText = f(hourly[4]);
                $('w-night').innerText = f(hourly[7]);

                // æ¹¿åº¦/UV
                $('hum').innerText = cur.humidity + "%";
                $('uv').innerText = cur.uvIndex;

                // --- ã€ğŸ§  èƒŒæ™¯é€»è¾‘æ§åˆ¶ã€‘ ---
                let type = 'cloudy';
                const desc = cur.weatherDesc[0].value.toLowerCase();
                const rain = parseFloat(cur.precipMM);
                const wind = parseFloat(cur.windspeedKmph);

                if(desc.includes("sun") || desc.includes("clear")) type = 'sunny';
                if(rain > 0) type = rain > 2 ? 'rain_heavy' : 'rain_light';
                if(desc.includes("thunder")) type = 'thunder';
                
                drawArt(type, wind > 20); // å¦‚æœé£é€Ÿå¤§äº20km/hï¼Œå åŠ é£å­—ç¬¦
                
                $('syncBtn').innerText = "âœ… åŒæ­¥æˆåŠŸ";
            });
    };
</script>
</body>
</html>
